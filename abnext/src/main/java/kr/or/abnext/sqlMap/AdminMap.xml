<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admin">
	
	<!-- 회원등록 -->
	<insert id="addUser" parameterType="kr.or.abnext.domain.TbUser">
		INSERT INTO TB_USER(
			USER_ZIP
			, USER_TEL
			, USER_RN
			, USER_PASS
			, USER_NM
			, USER_MEMO
			, USER_LEV
			, USER_ID
			, USER_HP
			, USER_FAX
			, USER_EMAIL
			, USER_DTL_ADR
			, USER_BANK_NM
			, USER_ADR
			, USER_ACCOUNT_NO
			, UPT_ID
			, UPT_DT
			, SIGUNGU_NM
			, SIDO_NM
			, INS_ID
			, INS_DT
			, HOSP_NO
			, FARM_NO
		) VALUES(
			#{userZip}
			, #{userTel}
			, #{userRn}
			, #{userPass}
			, #{userNm}
			, #{userMemo}
			, #{userLev}
			, #{userId}
			, #{userHp}
			, #{userFax}
			, #{userEmail}
			, #{userDtlAdr}
			, #{userBankNm}
			, #{userAdr}
			, #{userAccountNo}
			, #{userId}
			, now()
			, #{sigunguNm}
			, #{sidoNm}
			, #{userId}
			, now()
			, #{hospNo}
			, #{farmNo}
		)
	</insert>
	
	<!-- 회원정보 수정 -->
	<update id="modifyUser" parameterType="kr.or.abnext.domain.TbUser">
		UPDATE TB_USER
		   SET USER_ZIP
			   , USER_TEL	= #{userTel}
			   , USER_RN	= #{userRn}
			   , USER_PASS	= #{userPass}
			   , USER_NM	= #{userNm}
			   , USER_MEMO	= #{userMemo}
			   , USER_LEV	= #{userLev}
			   , USER_ID	= #{userId}
			   , USER_HP	= #{userHp}
			   , USER_FAX	= #{userFax}
			   , USER_EMAIL	= #{userEmail}
			   , USER_DTL_ADR	= #{userDtlAdr}
			   , USER_BANK_NM	= #{userBankNm}
			   , USER_ADR		= #{userAdr}
			   , USER_ACCOUNT_NO= #{userAccountNo}
			   , UPT_ID		= #{uptId}
			   , UPT_DT		= now()
			   , SIGUNGU_NM	= #{sigunguNm}
			   , SIDO_NM	= #{sidoNm}
			   , HOSP_NO	= #{hospNo}
			   , FARM_NO	= #{farmNo}
	     WHERE USER_NO = #{userNo} 
	</update>

	<!-- 병원검색 -->
	<select id="searchHospital" parameterType="kr.or.abnext.domain.TbHospital" resultType="kr.or.abnext.domain.TbHospital">
		SELECT *
		  FROM TB_HOSPITAL
		 WHERE HOSP_NM LIKE CONCAT('%', #{hospNm}, '%') 
	</select>
	
	<!-- 농장검색 -->
	<select id="searchFarm" parameterType="kr.or.abnext.domain.TbFarm" resultType="kr.or.abnext.domain.TbFarm">
		SELECT *
		  FROM TB_FARM
		 WHERE FARM_NM LIKE CONCAT('%', #{farmNm}, '%') 
	</select>
	
	<!-- 회원조회 -->
	<select id="getUserList" resultType="kr.or.abnext.domain.TbUser">
		SELECT USER_ZIP
			   , USER_TEL
			   , USER_RN
			   , USER_PASS
			   , USER_NM
			   , USER_MEMO
			   , USER_LEV
			   , USER_ID
			   , USER_HP
			   , USER_FAX
			   , USER_EMAIL
			   , USER_DTL_ADR
			   , USER_BANK_NM
			   , USER_ADR
			   , USER_ACCOUNT_NO
			   , UPT_ID
			   , UPT_DT
			   , SIGUNGU_NM
			   , SIDO_NM
			   , INS_ID
			   , INS_DT
			   , (SELECT HOSP_NM FROM TB_HOSPITAL WHERE HOSP_NO = A.HOSP_NO) AS HOSP_NM
			   , (SELECT FARM_NM FROM TB_FARM WHERE FARM_NO = A.FARM_NO) AS FARM_NM
		  FROM TB_USER A
		 ORDER BY USER_NO
	</select>
	
	<!-- 기관(병원)조회 -->
	<select id="getHospList" resultType="kr.or.abnext.domain.TbHospital">
		SELECT *
		  FROM TB_HOSPITAL
	</select>
	
	<!-- 농장조회 -->
	<select id="getFarmList" resultType="kr.or.abnext.domain.TbFarm">
		SELECT *
		  FROM TB_FARM
	</select>
	
	
	<!-- 병원등록 -->
	<insert id="addHosp" parameterType="kr.or.abnext.domain.TbHospital" useGeneratedKeys="true" keyProperty="hospNo">
		INSERT INTO TB_HOSPITAL(
			HOSP_NM
			,HOSP_TEL
			,HOSP_HP
			,HOSP_EMAIL
			,HOSP_FAX
			,HOSP_ADR
			,HOSP_DTL_ADR
			,HOSP_ZIP
			,HOSP_CEO
			,HOSP_RN
			,HOSP_SIDO_NM
			,HOSP_SIGUNGU_NM
			,HOSP_ACCOUNT_NO
			,HOSP_BANK_NM
			,INS_DT
			,INS_ID
			,UPT_DT
			,UPT_ID			
		) VALUES(
			#{hospNm}
			,#{hospTel}
			,#{hospHp}
			,#{hospEmail}
			,#{hospFax}
			,#{hospAdr}
			,#{hospDtlAdr}
			,#{hospZip}
			,#{hospCeo}
			,#{hospRn}
			,#{hospSidoNm}
			,#{hospSigunguNm}
			,#{hospAccountNo}
			,#{hospBankNm}
			,NOW()
			,#{insId}
			,NOW()
			,#{insId}
		)
	</insert>
	
	<!-- 병원삭제 -->
	<delete id="delHosp" parameterType="java.util.ArrayList">
		DELETE FROM TB_HOSPITAL
		WHERE HOSP_NO IN (
			<foreach collection="list" item="item" index="i" separator=",">
				${item}
			</foreach>
		)
	</delete>
	
	
	<!-- 농장등록 -->
	<insert id="addFarm" parameterType="kr.or.abnext.domain.TbFarm" useGeneratedKeys="true" keyProperty="farmNo">
		INSERT INTO TB_FARM(
			FARM_NM
			,FARM_CEO
			,FARM_TEL
			,FARM_HP
			,FARM_FAX
			,FARM_ADR
			,FARM_DTL_ADR
			,FARM_ZIP
			,FARM_EMAIL
			,FARM_RN
			,FARM_SIDO_NM
			,FARM_SIGUNGU_NM
			,FARM_BANK_NM
			,FARM_ACCOUNT_NO
			,INS_DT
			,INS_ID
			,UPT_DT
			,UPT_ID
		) VALUES(
			#{farmNm}
			,#{farmCeo}
			,#{farmTel}
			,#{farmHp}
			,#{farmFax}
			,#{farmAdr}
			,#{farmDtlAdr}
			,#{farmZip}
			,#{farmEmail}
			,#{farmRn}
			,#{farmSidoNm}
			,#{farmSigunguNm}
			,#{farmBankNm}
			,#{farmAccountNo}
			,NOW()
			,#{insId}
			,NOW()
			,#{insId}
		)
	</insert>
	
	<!-- 병원삭제 -->
	<delete id="delFarm" parameterType="java.util.ArrayList">
		DELETE FROM TB_FARM
		WHERE FARM_NO IN (
			<foreach collection="list" item="item" index="i" separator=",">
				${item}
			</foreach>
		)
	</delete>
	
	<!-- 파일등록 -->
	<select id="addFile" parameterType="kr.or.abnext.domain.TbFile">
		INSERT INTO TB_FILE(
			FILE_GB
			, FILE_PATH
			, FILE_ORI_NM
			, FILE_NEW_NM
			, FILE_MEMO
			, RQST_NO
			, HOSP_NO
			, USER_NO
			, ANIM_NO
			, FARM_NO
			, BOARD_NO						
		) VALUES(
			#{fileGb}
			, #{filePath}
			, #{fileOriNm}
			, #{fileNewNm}
			, #{fileMemo}
			, #{rqstNo}
			, #{hospNo}
			, #{userNo}
			, #{animNo}
			, #{farmNo}
			, #{boardNo}
		)
	</select>
	
	
</mapper>