<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="inspection">
	<select id="getNextKey" resultType="java.lang.String">
		SELECT AUTO_INCREMENT
		  FROM INFORMATION_SCHEMA.TABLES
		 WHERE TABLE_SCHEMA = 'avinext'
		   AND TABLE_NAME = 'TB_RCEPT'
	</select>

	<select id="selectDoctorList" parameterType="kr.or.abnext.domain.TbUser" resultType="kr.or.abnext.domain.TbUser">
		SELECT *
		  FROM TB_USER
		 WHERE HOSP_NO = (SELECT HOSP_NO FROM TB_USER WHERE USER_ID = #{userId})
		   AND USER_LEV = '2'
	</select>

	<insert id="insertRcept" parameterType="kr.or.abnext.domain.TbRcept">
		INSERT
		  INTO TB_RCEPT
		     (
		       RQST_NO       , HOSP_NO        , HOSP_NM
		     , USER_NO       , USER_NM        , ANIM_NO        , ANIM_NM
		     , DOC_NO        , DOC_NM
		     , ANIM_BUTLER   , BUTLER_SIDO    , BUTLER_SIGUNGU
		     , ANIM_FIRST_CD , ANIM_SECOND_CD , ANIM_THIRD_CD
		     , ANIM_BIRTH    , ANIM_SEX       , RQST_DT        , RQST_MEMO
		     , PROC_STAT     , PROC_STAT_NM
		     , PAY_GB        , PRICE          , PAY_STAT
		     , INS_DT        , INS_ID
		     )
		VALUES
		     (
		       #{rqstNo}       , #{hospNo}        , #{hospNm}
		     , #{userNo}       , #{userNm}        , #{animNo}        , #{animNm}
		     , #{docNo}        , #{docNm}
		     , #{animButler}   , #{butlerSido}    , #{butlerSigungu}
		     , #{animFirstCd}  , #{animSecondCd}  , #{animThirdCd}
		     , #{animBirth}    , #{animSex}       , NOW()            , #{rqstMemo}
		     , #{procStat}     , #{procStatNm}
		     , #{payGb}        , #{price}         , #{payStat}
		     , NOW()           , #{insId}
		     )
	</insert>

	<insert id="insertInspection" parameterType="kr.or.abnext.domain.TbInspection">
		INSERT
		  INTO TB_INSPECTION
		     (
		       RQST_NO       , SAMPLE_CODE
		     , INSP_FIRST_CD , INSP_SECOND_CD , INSP_THIRD_CD , INSP_PRICE
		     , INS_DT        , INS_ID
		     )
		VALUES
		     (
		       #{rqstNo}      , #{sampleCode}
		     , #{inspFirstCd} , #{inspSecondCd} , #{inspThirdCd} , #{inspPrice}
		     , NOW()          , #{insId}
		     )
	</insert>

	<insert id="insertSample" parameterType="kr.or.abnext.domain.TbSample">
		INSERT
		  INTO TB_SAMPLE
		     (
		       RQST_NO       , SAMPLE_CODE    , SAMPLE_MEMO
		     , INS_DT        , INS_ID
		     )
		VALUES
		     (
		       #{rqstNo}      , #{sampleCode} , #{sampleMemo}
		     , NOW()          , #{insId}
		     )
	</insert>

	<select id="selectRceptList" parameterType="kr.or.abnext.domain.TbRcept" resultType="kr.or.abnext.domain.TbRcept">
		SELECT *
		  FROM TB_RCEPT
	</select>

	<select id="selectInspList" parameterType="kr.or.abnext.domain.TbInspection" resultType="kr.or.abnext.domain.TbInspection">
		SELECT A.*
		     , (SELECT CODE_NM FROM TB_CODE B WHERE B.CODE_ID = A.INSP_FIRST_CD) AS INSP_FIRST_NM
		     , (SELECT CODE_NM FROM TB_CODE B WHERE B.CODE_ID = A.INSP_SECOND_CD) AS INSP_SECOND_NM
		     , (SELECT CODE_NM FROM TB_CODE B WHERE B.CODE_ID = A.INSP_THIRD_CD) AS INSP_THIRD_NM
		  FROM TB_INSPECTION A
		 WHERE RQST_NO = #{rqstNo}
	</select>

	<select id="selectSampleList" parameterType="kr.or.abnext.domain.TbSample" resultType="kr.or.abnext.domain.TbSample">
		SELECT A.*
		     , (SELECT CODE_NM FROM TB_CODE B WHERE B.CODE_ID = A.SAMPLE_CODE) AS SAMPLE_NAME
		  FROM TB_SAMPLE A
		 WHERE RQST_NO = #{rqstNo}
	</select>

	<select id="getTbRcept" parameterType="kr.or.abnext.domain.TbRcept" resultType="kr.or.abnext.domain.TbRcept">
		SELECT *
		  FROM TB_RCEPT
		 WHERE RQST_NO = #{rqstNo}
	</select>
</mapper>